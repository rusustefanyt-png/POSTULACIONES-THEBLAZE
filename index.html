<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THEBLAZE | OFFICIAL RECRUITMENT</title>
    <link href="https://fonts.cdnfonts.com/css/minecraftia" rel="stylesheet">
    <style>
        :root {
            --neon-green: #00ff88;
            --neon-red: #ff0044;
            --glass: rgba(20, 20, 20, 0.7);
            --mc-btn-bg: #aba3a3;
            --mc-btn-border-light: #ffffff;
            --mc-btn-border-dark: #5a5a5a;
        }

        body {
            background: #050505;
            color: #fff;
            font-family: 'Minecraftia', sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            background-image: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), 
                              url('https://www.nintendo.com/eu/media/images/10_share_images/games_15/nintendo_switch_4/2x1_NSwitch_Minecraft_image600w.jpg');
            background-size: cover;
            background-attachment: fixed;
        }

        .app-window {
            width: 90%;
            max-width: 900px;
            margin: 50px 0;
            background: var(--glass);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1);
            border-top: 5px solid var(--neon-green);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.9);
        }

        h1 { text-align: center; text-transform: uppercase; letter-spacing: 5px; color: var(--neon-green); }
        .input-box { background: rgba(0,0,0,0.4); border: 2px solid #333; padding: 15px; color: #fff; width: 100%; box-sizing: border-box; font-family: 'Minecraftia', sans-serif; border-radius: 4px; margin-top: 10px; }
        label { color: #aaa; font-size: 0.8rem; text-transform: uppercase; }

        .btn-submit { background: var(--neon-green); border: none; padding: 20px; width: 100%; font-family: 'Minecraftia', sans-serif; font-size: 1.2rem; cursor: pointer; margin-top: 30px; }
        
        #admin-panel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 5000; padding: 50px; overflow-y: auto; background: rgba(0,0,0,0.95); box-sizing: border-box; }
        .admin-controls { display: flex; gap: 20px; margin-bottom: 30px; background: #222; padding: 20px; border-radius: 8px; border: 1px solid #444; }
        .card { background: var(--glass); border: 2px solid #555; padding: 25px; margin-bottom: 20px; border-radius: 4px; }
        
        .mc-button { position: relative; background: var(--mc-btn-bg); border: 4px solid; border-color: var(--mc-btn-border-light) var(--mc-btn-border-dark) var(--mc-btn-border-dark) var(--mc-btn-border-light); color: #373737; padding: 12px; font-family: 'Minecraftia'; cursor: pointer; }
        .btn-big { font-size: 1.2rem; flex: 1; }
        .btn-open { background: #3fa03f; color: white; }
        .btn-close { background: #a03f3f; color: white; }

        #final-screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .ban-bg { background-color: #000; background-image: radial-gradient(circle, #400 0%, #000 100%); color: white; }
        .win-bg { background-image: linear-gradient(rgba(0,255,136,0.6), rgba(0,0,0,0.9)), url('https://i.redd.it/pvtq01k812o61.png'); background-size: cover; }
    </style>
</head>
<body>

<div id="closed-msg" style="display:none; text-align:center; margin-top:100px; width: 100%;">
    <h1 style="color:var(--neon-red); font-size:3rem;">POSTULACIONES CERRADAS</h1>
    <p>El equipo de THEBLAZE no está aceptando nuevos miembros por ahora.</p>
</div>

<div id="main-ui" class="app-window">
    <h1>THEBLAZE <span style="color:#fff">APPLY</span></h1>
    <form id="postuForm">
        <label>Nick de Minecraft</label><input type="text" id="v1" class="input-box" required>
        <label>Nick de Discord</label><input type="text" id="v2" class="input-box" required>
        <label>Edad</label>
        <select id="v3" class="input-box"><option>Menos de 12</option><option>12</option><option>Más de 12</option></select>
        <label>¿Premium?</label><select id="v4" class="input-box"><option>Si</option><option>No</option></select>
        <label>Tiempo jugando Minecraft</label><input type="text" id="v5" class="input-box">
        <label>¿Activo?</label><select id="v6" class="input-box"><option>Si</option><option>No</option></select>
        <label>¿Conoces la ID? Explícala</label><textarea id="v7" class="input-box" rows="2"></textarea>
        <label>Sanciones en Minecraft</label><input type="text" id="v8" class="input-box">
        <label>Sanciones Discord TheBlaze</label><input type="text" id="v9" class="input-box">
        <label>Diferencia Spam y Flood</label><textarea id="v10" class="input-box" rows="2"></textarea>
        <label>¿Qué es un Warn?</label><input type="text" id="v11" class="input-box">
        <label>¿Staff en otra network?</label><select id="v12" class="input-box"><option>Si</option><option>No</option></select>
        <label>Experiencia como staff</label><textarea id="v13" class="input-box" rows="2"></textarea>
        <label>Experiencia programando</label><textarea id="v14" class="input-box" rows="2"></textarea>
        <label>10 bots que no estén en TheBlaze</label><textarea id="v15" class="input-box" rows="2"></textarea>
        <label>¿Qué harías ante algo ilegal?</label><textarea id="v16" class="input-box" rows="2"></textarea>
        <label>10 comandos útiles Discord</label><textarea id="v17" class="input-box" rows="2"></textarea>
        <label>10 comandos útiles Nautic</label><textarea id="v18" class="input-box" rows="2"></textarea>
        <label>Si tu amigo hace algo ilegal</label><textarea id="v19" class="input-box" rows="2"></textarea>
        <label>¿Staff corrupto?</label><textarea id="v20" class="input-box" rows="2"></textarea>
        <label>¿Aceptas el rol staff?</label><select id="v21" class="input-box"><option>Si</option><option>No</option></select>
        
        <button type="submit" class="btn-submit" id="btnSubmit">ENVIAR AL SISTEMA</button>
    </form>
</div>

<div id="admin-panel">
    <h1 style="color: white; text-align: left;">PANEL DE CONTROL CLOUD</h1>
    <div class="admin-controls">
        <button class="mc-button btn-big btn-open" onclick="setSystemStatus(true)">ABRIR POSTULACIONES</button>
        <button class="mc-button btn-big btn-close" onclick="setSystemStatus(false)">CERRAR POSTULACIONES</button>
        <button class="mc-button" style="background:red; color:white;" onclick="location.reload()">SALIR</button>
    </div>
    <div id="cards-container"></div>
</div>

<div id="final-screen">
    <div id="final-msg" style="font-size: 2.5rem; padding: 20px; background: rgba(0,0,0,0.8); border: 4px solid white;"></div>
</div>

<script>
    const MASTER_KEY = "$2a$10$Axc/bU98eP8gJ.xFYRIA8OL.1yGeVRU6tzUigKHgfKKKKo8QBiSyu";
    const BIN_ID = "659617aabd0ea881f406070bd";
    const NORMAL_PASS = "TH3BL4Z3APPLYS";

    // --- FUNCIÓN DE CONEXIÓN MAESTRA (CORRIGE EL ERROR DE RED/CORS) ---
    async function cloudRequest(method = 'GET', bodyData = null) {
        const url = `https://api.jsonbin.io/v3/b/${BIN_ID}${method === 'GET' ? '/latest' : ''}`;
        const headers = {
            "Content-Type": "application/json",
            "X-Master-Key": MASTER_KEY,
            "X-Bin-Private": "true"
        };

        const response = await fetch(url, {
            method: method,
            headers: headers,
            body: bodyData ? JSON.stringify(bodyData) : null
        });

        if (!response.ok) throw new Error("Fallo en la nube");
        return await response.json();
    }

    // Verificar estado al cargar
    window.onload = async () => {
        try {
            const data = await cloudRequest('GET');
            if (data.record.sistema_abierto === false) {
                document.getElementById('main-ui').style.display = 'none';
                document.getElementById('closed-msg').style.display = 'block';
            }
        } catch(e) { console.error("Error de inicio:", e); }
    };

    // F4 para Admin
    window.addEventListener('keydown', (e) => {
        if (e.key === "F4") {
            let pass = prompt("ADMIN PASS:");
            if (pass === NORMAL_PASS) openAdmin();
        }
    });

    async function setSystemStatus(status) {
        try {
            const data = await cloudRequest('GET');
            data.record.sistema_abierto = status;
            await cloudRequest('PUT', data.record);
            alert(status ? "SISTEMA ABIERTO" : "SISTEMA CERRADO");
            location.reload();
        } catch(e) { alert("Error al cambiar estado"); }
    }

    async function deletePostu(index) {
        if(!confirm("¿BORRAR POSTULACIÓN?")) return;
        try {
            const data = await cloudRequest('GET');
            data.record.postulaciones.splice(index, 1);
            await cloudRequest('PUT', data.record);
            openAdmin();
        } catch(e) { alert("Error al borrar"); }
    }

    document.getElementById('postuForm').onsubmit = async (e) => {
        e.preventDefault();
        const btn = document.getElementById('btnSubmit');
        btn.disabled = true;
        btn.innerText = "ENVIANDO...";

        try {
            const data = await cloudRequest('GET');
            
            if (data.record.sistema_abierto === false) {
                alert("¡CERRADO!");
                location.reload();
                return;
            }

            let formData = { fecha: new Date().toLocaleString() };
            for(let i=1; i<=21; i++) formData["P"+i] = document.getElementById("v"+i).value;

            if(!data.record.postulaciones) data.record.postulaciones = [];
            data.record.postulaciones.push(formData);

            await cloudRequest('PUT', data.record);
            alert("ENVIADO CON ÉXITO");
            e.target.reset();
        } catch (err) { 
            alert("Error de red. Asegúrate de que el BIN tiene: { \"sistema_abierto\": true, \"postulaciones\": [] }"); 
        } finally { 
            btn.disabled = false; 
            btn.innerText = "ENVIAR AL SISTEMA";
        }
    };

    async function openAdmin() {
        const cont = document.getElementById('cards-container');
        document.getElementById('admin-panel').style.display = 'block';
        cont.innerHTML = "<h2 style='color:white'>CARGANDO...</h2>";

        try {
            const data = await cloudRequest('GET');
            const db = data.record.postulaciones || [];
            cont.innerHTML = db.length === 0 ? "<h2 style='color:white'>VACÍO.</h2>" : "";
            
            db.forEach((item, i) => {
                let div = document.createElement('div');
                div.className = "card";
                div.innerHTML = `
                    <h2 style="color:var(--neon-green)">POSTULANTE #${i+1}</h2>
                    <div style="font-size:0.75rem; color:#fff; line-height:1.4;">
                        ${Object.entries(item).map(([k,v]) => `<div><b>${k}:</b> ${v}</div>`).join('')}
                    </div>
                    <div style="margin-top:15px; display:flex; gap:10px;">
                        <button class="mc-button" style="background:#3fa03f; color:white;" onclick="executeEnd('win', 'ACEPTADO')">ACEPTAR</button>
                        <button class="mc-button" style="background:#ff4444; color:white;" onclick="deletePostu(${i})">BORRAR</button>
                    </div>`;
                cont.appendChild(div);
            });
        } catch(e) { cont.innerHTML = "Error de conexión."; }
    }

    function executeEnd(mode, text) {
        document.getElementById('admin-panel').style.display = 'none';
        document.getElementById('main-ui').style.display = 'none';
        const screen = document.getElementById('final-screen');
        screen.style.display = 'flex';
        screen.className = mode === 'ban' ? 'ban-bg' : 'win-bg';
        document.getElementById('final-msg').innerText = text;
    }
</script>
</body>
</html>
